<form class="{{cssClass}} v-sheet" autocomplete="off">

  <div class="v-grid">

    <!-- LEFT: Attributes -->
    <aside class="v-col v-col--left">

      <div class="v-attrgrid">
        {{#each vitruvium.attributes as |a|}}
          <div class="v-attrcard">
            <div class="v-attrcard__label">
              <span class="v-attrcard__icon">{{a.icon}}</span>
              <span class="v-attrcard__text">{{a.label}}</span>
            </div>

            <div
              class="v-attrcard__value"
              role="button"
              title="Нажми чтобы сделать проверку"
              data-action="roll-attribute"
              data-attr="{{a.key}}"
              data-label="{{a.label}}"
            >
              {{a.value}}
            </div>

            <div class="v-attrcard__ctrl">
              <button
                type="button"
                class="v-mini"
                data-action="attr-dec"
                data-attr="{{a.key}}"
              >–</button>
              <button
                type="button"
                class="v-mini"
                data-action="attr-inc"
                data-attr="{{a.key}}"
              >+</button>
            </div>
          </div>
        {{/each}}
      </div>

    </aside>

    <!-- CENTER: Portrait + Rolls + Inventory -->
    <main class="v-col v-col--center">

      <section class="v-hero">
        <div class="v-hero__portrait">
          <img
            class="v-portrait"
            src="{{actor.img}}"
            data-edit="img"
            title="{{actor.name}}"
          />
          <button
            type="button"
            class="v-btn v-btn--ghost"
            data-action="luck-roll"
          >
            Бросок удачи
          </button>
        </div>

        <div class="v-hero__meta">
          <input
            class="v-name"
            type="text"
            name="name"
            value="{{actor.name}}"
            placeholder="Имя персонажа"
          />

          <div class="v-resrow">
            <div class="v-res v-res--hp">
              <div class="v-res__label">HP</div>
              <input
                class="v-res__input"
                type="number"
                name="system.attributes.hp.value"
                value="{{vitruvium.hp.value}}"
                min="0"
                data-dtype="Number"
              />
              <div class="v-res__sep">/</div>
              <div class="v-res__max">{{vitruvium.hp.max}}</div>
            </div>

            <div class="v-res v-res--insp">
              <div class="v-res__label">Вдохн.</div>
              <div class="v-res__btns">
                <button
                  type="button"
                  class="v-mini"
                  data-action="insp-dec"
                >–</button>
                <div class="v-res__val">{{vitruvium.inspiration.value}}</div>
                <button
                  type="button"
                  class="v-mini"
                  data-action="insp-inc"
                >+</button>
              </div>
              {{!-- <div class="v-res__hint">max {{vitruvium.inspiration.max}}</div> --}}
            </div>
          </div>

          <div class="v-rollrow">
            <div class="v-rollbox">
              <div class="v-rollbox__label">Доп. кубы</div>
              <div class="v-rollbox__ctrl">
                <button
                  type="button"
                  class="v-mini"
                  data-action="extra-dec"
                >–</button>
                <div class="v-rollbox__val">{{vitruvium.extraDice}}</div>
                <button
                  type="button"
                  class="v-mini"
                  data-action="extra-inc"
                >+</button>
                <button
                  type="button"
                  class="v-btn"
                  data-action="extra-roll"
                >Бросить</button>
              </div>
            </div>

            {{! <button
              type="button"
              class="v-btn v-btn--ghost"
              data-action="luck-roll"
            >
              Бросок удачи
            </button> }}
          </div>
        </div>
      </section>

      <!-- Inventory -->
      <section class="v-panel">
        <div class="v-panel__head">
          <div class="v-h2">Инвентарь</div>
          <div class="v-line"></div>
          <button
            type="button"
            class="v-btn v-btn--ghost"
            data-action="create-item"
          >+ Предмет</button>
        </div>

        <div class="v-list">
          {{#each vitruvium.items as |it|}}
            <div class="v-row">
              <div class="v-row__main">
                <div class="v-row__title">{{it.name}}</div>
                <div class="v-row__meta">×{{it.system.quantity}}</div>
              </div>

              <div class="v-row__btns">
                <button
                  type="button"
                  class="v-mini"
                  data-action="item-chat"
                  data-item-id="{{it._id}}"
                >В чат</button>
                <button
                  type="button"
                  class="v-mini"
                  data-action="edit-item"
                  data-item-id="{{it._id}}"
                >Откр.</button>
                <button
                  type="button"
                  class="v-mini v-mini--danger"
                  data-action="delete-item"
                  data-item-id="{{it._id}}"
                >✕</button>
              </div>
            </div>
          {{/each}}
        </div>
      </section>

    </main>

    <!-- RIGHT: Abilities -->
    <aside class="v-col v-col--right">
      <section class="v-panel-adv" style="margin-bottom: 8px;">
  <div class="v-panel__head">
    <div class="v-h2">Режим бросков</div>
    <div class="v-line"></div>
  </div>

  <div class="v-rollmode" role="group" aria-label="Режим бросков">
       <button type="button"
            class="v-mini {{#if (eq vitruvium.rollMode 'adv')}}is-active{{/if}}"
            data-action="set-rollmode"
            data-mode="adv">Adv</button>

    <button type="button"
            class="v-mini {{#if (eq vitruvium.rollMode 'normal')}}is-active{{/if}}"
            data-action="set-rollmode"
            data-mode="normal">Normal</button>

    <button type="button"
            class="v-mini {{#if (eq vitruvium.rollMode 'dis')}}is-active{{/if}}"
            data-action="set-rollmode"
            data-mode="dis">Dis</button>
  </div>

  <div class="v-subtle" style="margin-top: 6px;">
    Влияет на все броски (атрибуты, удача, доп. кубы).
  </div>
</section>


      <section class="v-panel">
        <div class="v-panel__head">
          <div class="v-h2">Способности</div>
          <div class="v-line"></div>
          <button
            type="button"
            class="v-btn v-btn--ghost"
            data-action="create-ability"
          >+ Способность</button>
        </div>

        <div class="v-list">
          {{#each vitruvium.abilities as |ab|}}
            <div class="v-row">
              <div class="v-row__main">
                <div class="v-row__title">{{ab.name}}</div>
                <div class="v-row__meta">стоим. {{ab.system.cost}}</div>
              </div>

              <div class="v-row__btns">
                <button
                  type="button"
                  class="v-mini"
                  data-action="use-ability"
                  data-item-id="{{ab._id}}"
                >Исп.</button>
                <button
                  type="button"
                  class="v-mini"
                  data-action="edit-item"
                  data-item-id="{{ab._id}}"
                >Откр.</button>
                <button
                  type="button"
                  class="v-mini v-mini--danger"
                  data-action="delete-item"
                  data-item-id="{{ab._id}}"
                >✕</button>
              </div>
            </div>
          {{/each}}
        </div>
      </section>

    </aside>

  </div>
</form>